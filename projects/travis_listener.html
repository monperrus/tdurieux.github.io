<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Travis Listener | Thomas Durieux</title>
    <meta name="description" content="Travis Listener is a small library that listen on real time  TravisCI API for new builds. It allows to interact as soon as possible with the authors of the builds for fixing it for example.">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" color="#648fa8" href="/safari-pinned-tab.svg">
  <meta name="msapplication-TileColor" content="#648fa8">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.cc81e4d0.css" as="style"><link rel="preload" href="/assets/js/app.5276072a.js" as="script"><link rel="preload" href="/assets/js/2.6b4fc385.js" as="script"><link rel="preload" href="/assets/js/8.a64a9829.js" as="script"><link rel="prefetch" href="/assets/js/10.3ecd458f.js"><link rel="prefetch" href="/assets/js/11.9a1f8820.js"><link rel="prefetch" href="/assets/js/12.22eb6abb.js"><link rel="prefetch" href="/assets/js/13.62f168a4.js"><link rel="prefetch" href="/assets/js/14.e98d4a95.js"><link rel="prefetch" href="/assets/js/15.d91a92a7.js"><link rel="prefetch" href="/assets/js/16.dba4483f.js"><link rel="prefetch" href="/assets/js/17.6ff61a70.js"><link rel="prefetch" href="/assets/js/18.90333532.js"><link rel="prefetch" href="/assets/js/19.8f7f6776.js"><link rel="prefetch" href="/assets/js/20.c94b0f6e.js"><link rel="prefetch" href="/assets/js/21.dc0602b3.js"><link rel="prefetch" href="/assets/js/22.a9c3d7df.js"><link rel="prefetch" href="/assets/js/23.05c64e97.js"><link rel="prefetch" href="/assets/js/24.7650a182.js"><link rel="prefetch" href="/assets/js/25.c4c32185.js"><link rel="prefetch" href="/assets/js/26.2a038839.js"><link rel="prefetch" href="/assets/js/27.a118b39e.js"><link rel="prefetch" href="/assets/js/28.10f4aa12.js"><link rel="prefetch" href="/assets/js/3.8c1b7e0e.js"><link rel="prefetch" href="/assets/js/4.cbb9f2e3.js"><link rel="prefetch" href="/assets/js/5.2637cb5e.js"><link rel="prefetch" href="/assets/js/6.c87682a6.js"><link rel="prefetch" href="/assets/js/7.b3475103.js"><link rel="prefetch" href="/assets/js/9.26384326.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cc81e4d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Thomas Durieux</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Curriculum Vitae</a></div><div class="nav-item"><a href="/research.html" class="nav-link">Research</a></div><div class="nav-item"><a href="/projects/" class="nav-link router-link-active">Open-source Projects</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Curriculum Vitae</a></div><div class="nav-item"><a href="/research.html" class="nav-link">Research</a></div><div class="nav-item"><a href="/projects/" class="nav-link router-link-active">Open-source Projects</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Projects</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/projects/anonymous_github.html" class="sidebar-link">Anonymous Github</a></li><li><a href="/projects/bibtex2wiki.html" class="sidebar-link">BibTex2Wiki</a></li><li><a href="/projects/bikiniproxy.html" class="sidebar-link">BikiniProxy</a></li><li><a href="/projects/bluelatex.html" class="sidebar-link">\BlueLatex</a></li><li><a href="/projects/c2spoon.html" class="sidebar-link">c2Spoon</a></li><li><a href="/projects/defects4j_dissection.html" class="sidebar-link">Defects4J Dissection</a></li><li><a href="/projects/introclass_java.html" class="sidebar-link">IntroclassJava</a></li><li><a href="/projects/itzal.html" class="sidebar-link">Itzal</a></li><li><a href="/projects/leboncoin.html" class="sidebar-link">LeBonCoin JS API</a></li><li><a href="/projects/maven-repair.html" class="sidebar-link">Maven-repair</a></li><li><a href="/projects/nopol.html" class="sidebar-link">Nopol</a></li><li><a href="/projects/npefix.html" class="sidebar-link">NPEFix</a></li><li><a href="/projects/spoon.html" class="sidebar-link">Spoon</a></li><li><a href="/projects/synctexjs.html" class="sidebar-link">SyncTeX-js</a></li><li><a href="/projects/travis_listener.html" class="active sidebar-link">Travis Listener</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="travis-listener"><a href="#travis-listener" aria-hidden="true" class="header-anchor">#</a> Travis Listener</h1> <p>Travis Listener is a small library that listen on real time  TravisCI API for new builds. It allows to interact as soon as possible with the author of the builds for fixing it for example.</p> <h2 id="example"><a href="#example" aria-hidden="true" class="header-anchor">#</a> Example</h2> <p>Using the API, I created a dashboard: https://travis.durieux.me that lists all the builds that are currently running on TravisCI.
<a href="https://travis.durieux.me/stat.html" target="_blank" rel="noopener noreferrer">This page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> contains some statistic on the builds such as the number of builds per language per hour, the number of failing/passing, ...</p> <p><img src="/assets/img/travis_listener.3dc9fce9.png" alt="Travis Listener"></p> <p>I also play with a more artistic representation of Travis activity. <a href="https://travis.durieux.me/rain.html" target="_blank" rel="noopener noreferrer">This page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> represents each build by is commit message that falls down like rain. The code of this example is available at: https://github.com/tdurieux/travis-listener/blob/master/script/static/js/rain.js#L357</p> <h2 id="usage"><a href="#usage" aria-hidden="true" class="header-anchor">#</a> Usage</h2> <p>Travis Listener is based on websockets. You can listen to the websocket to retrieve on real time the Travis builds.</p> <h3 id="install"><a href="#install" aria-hidden="true" class="header-anchor">#</a> Install</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">cd</span> script
<span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> run-script build
</code></pre></div><h3 id="start-server"><a href="#start-server" aria-hidden="true" class="header-anchor">#</a> Start server</h3> <p>User interface that monitors the jobs that are currently running at Travis-CI</p> <div class="language-js extra-class"><pre class="language-js"><code>npm run<span class="token operator">-</span>script server
</code></pre></div><h3 id="dashboard"><a href="#dashboard" aria-hidden="true" class="header-anchor">#</a> Dashboard</h3> <p>One the server is started you can open <code>http://localhost:9080</code> and see the activity on travis on real time.
The data is not stored, it is only rendered in your browser.</p> <h3 id="statistics"><a href="#statistics" aria-hidden="true" class="header-anchor">#</a> Statistics</h3> <p>When the server is running, basic statistics are collected such as the number of build for each language per hour or the number of builds for each status.
The statistics is visible at <code>http://localhost:9080/stat.html</code> and are based on the data available at <code>https://travis.durieux.me/api/stat</code>.</p> <h3 id="your-own-build-visualization"><a href="#your-own-build-visualization" aria-hidden="true" class="header-anchor">#</a> Your own build visualization</h3> <p>Travis Listener sent the information through websocket which is now supported by a huge amount of libraries in different languages: <a href="https://www.baeldung.com/websockets-api-java-spring-client" target="_blank" rel="noopener noreferrer">Java<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://pypi.org/project/websocket_client/" target="_blank" rel="noopener noreferrer">Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://github.com/gorilla/websocket" target="_blank" rel="noopener noreferrer">Go<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://www.npmjs.com/package/ws" target="_blank" rel="noopener noreferrer">node.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and also natively by all modern browsers.</p> <p>Here is an example on how to do it in browser JavaScript.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> host <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> protocol <span class="token operator">=</span> <span class="token string">&quot;ws&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>protocol <span class="token operator">==</span> <span class="token string">&quot;https:&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    protocol <span class="token operator">=</span> <span class="token string">&quot;wss&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> <span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// basic check if the message is in JSON format</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'{'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token comment">// event types</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>event <span class="token operator">==</span> <span class="token string">'job'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// a new job is detected on TravisCI</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>event <span class="token operator">==</span> <span class="token string">'updated_job'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// the status of an existing job is updated</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>event <span class="token operator">==</span> <span class="token string">'updated_job'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// the execution of a job is finished</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// job details, the structure of the job is available here: https://docs.travis-ci.com/api/#jobs</span>
    <span class="token keyword">var</span> job <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">var</span> commit <span class="token operator">=</span> job<span class="token punctuation">.</span>commit<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">startWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>protocol <span class="token operator">+</span> <span class="token string">'://'</span> <span class="token operator">+</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>onmessage <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ws<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> onmessage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Try to reconnect in 5 seconds</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">startWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">startWS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/06/2019</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/projects/synctexjs.html" class="prev">
          SyncTeX-js
        </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5276072a.js" defer></script><script src="/assets/js/2.6b4fc385.js" defer></script><script src="/assets/js/8.a64a9829.js" defer></script>
  </body>
</html>
